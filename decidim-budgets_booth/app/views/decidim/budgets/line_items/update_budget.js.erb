var $orderSelectedProjectsCount = $('#order-selected-projects-count');
var $orderProgress = document.querySelectorAll('[id^=order-progress] .budget-summary__content');
var $projectItem = $('#project-<%= project.id %>-item');
var $budgetConfirm = $('#budget-confirm');
var $projectModal = $('#project-modal-<%= project.id %>');

$orderProgress.forEach((orderProgress) => {
  var $orderTotalBudget = $(orderProgress).find("[id^=order-total-budget]");
  $orderTotalBudget.html('<%= j(render partial: "decidim/budgets/projects/order_total_budget").strip.html_safe %>');

  if(orderProgress.dataset.orderProgressResponsive) {
    morphdom(orderProgress, '<%= j(render partial: "decidim/budgets/projects/order_progress_summary_content", locals: { include_heading: true, responsive: true }).strip.html_safe %>');
  } else {
    morphdom(orderProgress, '<%= j(render partial: "decidim/budgets/projects/order_progress_summary_content", locals: { include_heading: true, responsive: false }).strip.html_safe %>');
  }
})
morphdom($budgetConfirm[0], '<%= j(render partial: "decidim/budgets/projects/budget_confirm").strip.html_safe %>')
if ($orderSelectedProjectsCount.length > 0) {
  morphdom($orderSelectedProjectsCount[0], '<%= j(render partial: "decidim/budgets/projects/projects_count", locals: { count: current_order.projects.size }).strip.html_safe %>')
}

if ($projectItem.length > 0) {
  <% if params[:action] == "destroy" && params[:show_only_added] == "true" %>
    $projectItem[0].remove();
  <% else %>
    morphdom($projectItem[0], '<%= j(render partial: "decidim/budgets/projects/project", locals: { project: }).strip.html_safe %>');
  <% end %>
}

if ($projectModal.length > 0) {
  var $projectModalButtonForm = $(".project-vote-button", $projectModal).parent();
  morphdom($projectModalButtonForm[0], '<%= j(cell("decidim/budgets/project_vote_button", project, scale_up: true)).strip.html_safe %>');
}

if ($projectModal.length > 0 && $projectModal.attr("aria-hidden") === "false") {
  $(".project-vote-button", $projectModal).focus();
} else {
  $(".project-vote-button", $projectItem).focus();
}

<% if @show_help_modal %>
  <script>
      (function() {
        console.log("Aja tää showhelpmodal")
        var $modal = $("#voting-help");

        if ($modal.length < 1) {
          console.log("Alle 1")
          $modal = $('<%= j(render partial: "decidim/budgets/partials/voting_help_modal").strip.html_safe %>');
          $("body").append($modal);
          console.log("Laita body")
          let dialog = new window.Decidim.Dialogs("#voting-help");
          console.log("Tee dialog")
          $modal.data("votingHelpModal", dialog);
        }

        $modal.data("votingHelpModal").open();
      })();
  </script>
<% end %>
