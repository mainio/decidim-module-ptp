<% add_decidim_meta_tags(
  title: translated_attribute(project.title),
  description: translated_attribute(project.description)
) %>

<%
edit_link(
  resource_locator([project.budget, project]).edit,
  :update,
  :project,
  project: project
)
%>

<%= append_javascript_pack_tag "decidim_budgets" %>
<%= append_stylesheet_pack_tag "decidim_budgets" %>

<%= cell("decidim/budgets/limit_announcement", budget) %>

<main class="voting-wrapper">
  <div class="projects-link">
    <%= link_to budget_projects_path(budget), class: "link js-back-to-list flex" do %>
      <%= icon "arrow-left-s-line", class: "icon--small h-6 w-6 pt-1 fill-[--primary]", role: "img", "aria-hidden": true %>
      <%= t("view_all_projects", scope: "decidim.budgets.projects.show") %>
    <% end %>
  </div>

  <div class="row columns">
    <% if voting_mode? %>
      <%= render partial: "budget_summary", locals: { include_heading: true } %>
    <% end %>
  </div>

  <% content_for :aside do %>
    <div class="layout-aside__section layout-aside__buttons flex justify-center items-center project-info">
      <div class="record-action-container card__content">
        <div class="m-bottom flex flex-col space-y-3 mb-4 text-center">
          <span class="definition-data__title"><%= t("budget", scope: "decidim.budgets.projects.show") %></span>
          <span class="definition-data__number"><%= budget_to_currency project.budget_amount %></span>
        </div>

        <%= cell("decidim/budgets/project_votes_count", project, layout: :one_line, class: "display-block") %>

        <% if voting_finished? %>
          <%= cell("decidim/budgets/project_voted_hint", project, class: "display-block") %>
        <% elsif voting_open? && !current_order_checked_out? %>
          <span class="text-wrap text-center text-lg mb-4"><%= t("introduction", scope: "decidim.budgets.projects.show.pre_vote") %></span>
          <%= link_to budget_voting_index_path(select_project: project.id), class: "button button__lg button__secondary prevote-start-button" do %>
            <span class="text-wrap"><%= progress?(budget) ? t("continue_voting", scope: "decidim.budgets.projects.show.pre_vote") : t("start_voting", scope: "decidim.budgets.projects.show.pre_vote") %></span>
            <%= icon "arrow-right-line" %>
          <% end %>
        <% else %>
          <%= cell("decidim/budgets/project_voted_hint", project, text_medium: true, class: "success text-m display-block margin-top-1") if current_order_checked_out? && voted_for?(project) %>
        <% end %>
      </div>
    </div>

    <div class="layout-aside__section layout-aside__buttons action-divider">
      <div class="record-action-container">
        <%= cell "decidim/share_button", nil, default_classes: false %>
        <%= cell "decidim/comments_button", nil %>
      </div>
    </div>
  <% end %>

  <%= render layout: "layouts/decidim/shared/layout_item" do %>
    <div class="row w-full space-y-8 lg:mx-0">
      <div id="project" class="columns section view-side mediumlarge-4 mediumlarge-push-8 large-3 large-push-9 flex justify-between">
        <h1 class="h2 md:h1"><%= translated_attribute project.title %></h1>
      </div>
      <div class="columns mediumlarge-8 mediumlarge-pull-4 space-y-8">
        <div class="section space-y-8">
          <%= cell("decidim/budgets/project_selected_status", project, as_label: true) %>
          <%= decidim_sanitize_editor translated_attribute project.description %>
          <%= cell "decidim/budgets/project_tags", project, context: { extra_classes: ["tags--project"] } %>
        </div>
        <%= attachments_for project %>
        <%= cell("decidim/linked_resources_for", project, type: :proposals, link_name: "included_proposals") %>
        <%= cell("decidim/linked_resources_for", project, type: :results, link_name: "included_projects") %>
      </div>
    </div>

    <% content_for :item_footer do %>
      <%= comments_for project, polymorphic: [project.budget] %>
      <ul class="metadata__container layout-main__section" data-metadata-footer>
        <%= content_tag :li, resource_reference(project), class: "metadata__item" %>
      </ul>
    <% end %>
  <% end %>

  <%= render partial: "decidim/shared/share_modal" %>
</main>

