<div id="order-progress">
  <div class="budget-summary__progressbox flex gap-12" data-current-allocation="<%= current_order ? current_order.total : 0 %>" data-progress-reference>
    <div class="progress budget-progress bg-white w-5/6 h-10" role="progressbar" aria-valuenow="<%= current_order_budget_percent %>" aria-valuetext="<%= current_order_budget_percent %>%" aria-valuemin="0" aria-valuemax="100">
      <div class="progress-meter progress-meter--minimum" style="width: <%= current_order_budget_percent_minimum %>%"></div>
      <!--Change width and text dynamically.-->
      <div class="progress-meter budget-progress__meter bg-gray-3 h-full flex items-center justify-center" style="width: <%= current_order_budget_percent %>%">
        <span class="progress-meter-text progress-meter-text--right font-semibold"><%= current_order_budget_percent %>%</span>
      </div>
    </div>
    <% if !current_order_checked_out? && voting_open? %>
      <button class="button button__sm button__secondary" data-dialog-open="budget-confirm" <%= budget_confirm_disabled_attr %>>
        <%= voting_booth_forced? ? t(".vote") : t(".ready") %>
        <%= icon("arrow-right-line") %>
      </button>
    <% end %>
  </div>

  <div class="progressbox-fixed-wrapper fixed top-0 left-0 right-0 z-50 bg-background shadow hidden is-progressbox-visible:block flex justify-center" data-progressbox-fixed>
    <div class="w-4/6 p-4">
      <div class="budget-summary__progressbox budget-summary__progressbox--fixed">
        <% if current_order.projects_rule? %>
          <div class="card__content budget-summary__selected">
            <% if current_order&.projects&.any? %>
              <button class="flex gap-2" data-dialog-open="selected-projects">
                <strong class="text-lg pr-6 pb-4"><%= t(".choices") %><%= current_order.maximum_projects - current_order.projects.size %></strong>
                <p class="text-lg"> <%= t(".show_choices") %> </p>
                <%= icon("menu-line", class:"icon--small mt-1", aria_label: t(".view"), role: "img") %>
              </button>
            <% else %>
              <div class="flex items-start justify-start">
                <strong class="text-lg pr-6 pb-4"><%= t(".choices") %><%= current_order.maximum_projects - current_order.projects.size %></strong>
              </div>
            <% end %>
          </div>
        <% else %>
          <div class="budget-summary__total text-left text-lg font-bold my-2" data-total-allocation="<%= current_order.available_allocation %>" data-total-budget="<%= budget.total_budget %>">
            <span class="mini-title"><%= t(".total_budget") %>
              <strong class="mini-title__strong mini-title__strong--highlight">
                <%= budget_to_currency(budget.total_budget) %>
              </strong>
            </span>
          </div>

          <div class="text-left mt-4 text-lg font-bold">
            <span class="mini-title">
              <%= t(".assigned") %>
              <%= render partial: "order_total_budget" %>
            </span>
          </div>

          <%= render partial: "order_selected_projects" %>
        <% end %>
      </div>
      <div class="budget-summary__progressbox budget-summary__progress--fixed flex gap-12">
        <div class="progress budget-progress budget-progress--fixed bg-white w-5/6 h-10" role="progressbar" aria-valuenow="<%= current_order_budget_percent %>" aria-valuetext="<%= current_order_budget_percent %>%" aria-valuemin="0" aria-valuemax="100">
          <div class="progress-meter progress-meter--minimum" style="width: <%= current_order_budget_percent_minimum %>%"></div>
          <div class="progress-meter budget-progress__meter bg-gray-3 h-full flex items-center justify-center" style="width: <%= current_order_budget_percent %>%">
            <span class="progress-meter-text progress-meter-text--right--fixed font-semibold"><%= current_order_budget_percent %>%</span>
          </div>
        </div>
        <% if !current_order_checked_out? && voting_open? %>
          <button class="button button__sm button__secondary" data-dialog-open="budget-confirm" <%= budget_confirm_disabled_attr %>>
            <%= voting_booth_forced? ? t(".vote") : t(".ready") %>
            <%= icon("arrow-right-line") %>
          </button>
        <% end %>
      </div>
    </div>
  </div>
</div>
